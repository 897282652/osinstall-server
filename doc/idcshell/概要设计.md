# 物理机装机接口定义

# 命令参数

1. query
   - query unit
   - query host
   - query user

2. exec
   - exec cmd for unit
   - exec cmd for host

3. refresh
   - refresh buffer (token, white list, unit, host, user&#x2026;)
   
4. show
   - show white cmd list
   - show black cmd list
   - show personal conf
   - show common conf
   - show plugin
   - show cmd history

# API接口

## cli客户端

### 用户类API

1.  登录API：验证登录用户名和密码，返回人员，角色，组织，token等信息
2.  用户配置API：各用户的个性化配置信息

### 查询类API

1. 查询部署单元：根据token查询有权限 **查看** 的部署单元
2. 查询部署单元：根据token查询有权限 **执行** 的部署单元
3. 查询部署单元用户信息：查询部署单元可以执行命令的用户信息
4. 查询主机：根据token查询有权限 **查看** 的主机
5. 查询主机：根据token查询有权限 **执行** 的主机
6. 查询主机用户信息：查询主机上可以执行命令的用户信息
7. 查询白名单：根据token查询白名单命令列表
8. 查询黑名单：根据token查询黑名单命令列表
9. 查询MQ证书信息：MCO通信方式时，获取需要的证书信息
10. 查询SSH信息：ssh通信方式时，获取ssh-key或者用户名密码

如果在proxy上实现命令调度的话，则不需要接口9，10

### 执行类API

1.  执行命令：发送命令执行需要的参数（用户，执行对象，命令等），获取执行结果并显示
    这个API可以是（http或者websocket）
2.  刷新缓存：刷新缓存的黑白名单，部署单元/主机信息等
    这个API也可以通过http手动刷新或者websocket自动刷新

## cli 服务端

1.  用户管理：CURD
2.  角色管理：CURD
3.  部门管理：CURD
4.  部署单元管理：CURD
5.  主机管理：CURD
6.  黑白名单管理：CURD
7.  证书管理：CURD
8.  SSH-KEY管理：CURD
9.  任务列表查询：查询当前执行的任务信息
10. 历史纪录审计：命令执行结果记录
11. 操作审计：登录操作，执行命令操作

# DB模型

1.  DataCenter 数据中心
    DataCenter
2.  App 应用
    App
3.  Unit 部署单元
    Unit
4.  Node 主机节点
    Node
5.  ExecLog 执行上报信息
    ExecLog
6.  WhiteCmd 白名单命令
    WhiteCmd
7.  BlackCmd 黑名单命令
    BlackCmd
8.  CmdHistory 命令历史
    用户输入的命令历史纪录
9.  User 用户
    User
10. UserProfile 用户个性化信息
    UserProfile
11. Role 角色
    Role
12. Group 分组
    Group
13. Dept 部门
    Dept
14. Auth 权限
    Auth
15. Task 任务
    Task
16. mco 信息
    MCOConf
17. ssh 信息
    SSHConf


